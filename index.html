<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cookie Clicker — CCCoin</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Основной стиль игры */
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(to bottom, #FFFFCC, #FFCC66); /* Жёлтый градиент */
            color: #333;
            text-align: center;
            min-height: 100vh; /* Зафиксированная минимальная высота */
            display: grid;
            place-items: center;
            overflow-x: hidden;
        }

        /* Шапка игры */
        header {
            margin-bottom: 20px;
        }

        /* Логотип и главное изображение */
        h1 {
            font-size: 1.5em; /* Читабельный размер текста */
            color: #8b4513;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        /* Контейнер для клика по печенью */
        .cookie-container {
            position: relative;
            cursor: pointer;
            animation-duration: 0.5s;
            animation-name: bounce;
            animation-timing-function: cubic-bezier(.4,.2,.2,1);
        }

        /* Главное изображение печенья */
        img {
            max-width: 150px; /* Большой размер для комфорта тапов */
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border-radius: 50%;
            transition: transform 0.3s ease-in-out;
        }

        /* Мерцающий эффект на активной картинке */
        .cookie-container.active img {
            animation: shine 1s infinite alternate;
        }

        @keyframes shine {
            from {
                box-shadow: 0 0 10px rgba(255, 255, 0, 0.5);
            }
            to {
                box-shadow: 0 0 30px rgba(255, 255, 0, 1);
            }
        }

        /* При нажатии на изображение печенья */
        .cookie-container:active img {
            transform: scale(0.9);
        }

        /* Анимация прыжка печенья */
        @keyframes bounce {
            from {
                transform: translateY(-10%);
            }
            to {
                transform: translateY(0);
            }
        }

        /* Счётчик полученных печенек */
        #coins {
            font-size: 1.8em; /* Удобный размер счётчика */
            font-weight: bold;
            margin-top: 10px;
            color: #cc6600;
        }

        /* Стили для кнопок и магазинов */
        button {
            padding: 10px 20px;
            border-radius: 5px;
            color: white;
            background-color: #ff6347;
            font-size: 16px; /* Удобный размер текста */
            transition: all 0.3s ease-in-out;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        button:hover,
        button:focus {
            transform: scale(1.1);
            background-color: #ff4500;
        }

        /* Карточки улучшений */
        .store-item {
            display: block; /* Одностолбцовое представление */
            width: calc(100% - 20px); /* Занимает почти весь экран */
            height: auto;
            border: 1px solid #333;
            margin: 10px auto;
            padding: 10px;
            text-align: center;
            vertical-align: top;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            border-radius: 10px;
        }

        /* Раскрывающееся меню настроек */
        #settings-menu {
            position: absolute;
            top: 60px;
            right: 10px;
            background-color: #ffffff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            visibility: hidden; /* Скрыть меню настроек по умолчанию */
            opacity: 0;
            transition: visibility 0.3s, opacity 0.3s;
        }

        #settings-menu.visible {
            visibility: visible;
            opacity: 1;
        }

        /* Кнопка открытия меню настроек */
        #settings-button {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
        }

        /* Достижения */
        #achievements {
            position: fixed;
            top: 10px;
            left: 10px;
            list-style-type: none;
            padding: 0;
            margin: 0;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            padding: 10px;
        }

        #achievements li {
            display: block;
            margin-bottom: 5px;
            font-size: 1.2em;
            color: #8b4513;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* Песочница для вылетающих печений */
        .particles-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none; /* Игнорируем взаимодействие с песочницей */
            z-index: 1000;
        }

        /* Мини-печеньки */
        .flying-cookie {
            position: absolute;
            opacity: 0;
            transform: translateX(-50%) translateY(-50%);
            animation: flyAway 1s ease-in-out forwards;
            width: 20px; /* Уменьшили размер печенья */
            height: 20px;
        }

        @keyframes flyAway {
            0% {
                transform: translateX(-50%) translateY(-50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateX(-50%) translateY(-50%) translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        /* Для мобильной версии кнопка должна быть большой и удобной */
        @media screen and (max-width: 768px) {
            button {
                padding: 15px 30px;
                font-size: 18px;
            }

            .cookie-container img {
                max-width: 120px; /* Немного уменьшаем размер для небольших экранов */
            }
        }

        /* Саундэффекты */
        audio {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <header>
        <h1 id="gameTitle">Cookie Clicker — CCCoin</h1>
        <p id="versionLabel">(ЭТО БЕТА-ВЕРСИЯ 1.1 НЕ СУДИТЕ СТРОГО)</p>
    </header>

    <!-- Основная игровая область -->
    <main>
        <section>
            <div class="cookie-container" onclick="clickCookie(event)">
                <img src="cookie.png" alt="Cookie" style="width: 150px; height: auto;" />
            </div>
            <p id="coins">Cookies: 0</p>
        </section>

        <!-- Меню настроек (скрытые по умолчанию) -->
        <div id="settings-menu">
            <button onclick="toggleLanguage()">Русский / English</button>
            <button onclick="toggleSound()">Выключить звук</button>
            <button onclick="bindWallet()">Привязать кошелёк</button>
        </div>

        <!-- Отдельная кнопка для открытия настроек -->
        <button id="settings-button" onclick="toggleSettings()">Настройки ⚙</button>
    </main>

    <!-- Магазин -->
    <h2 id="storeHeader">Магазин улучшений:</h2>
    <div id="store"></div>

    <!-- Блок для достижений -->
    <ul id="achievements"></ul>

    <!-- Песочница для вылетающих печений -->
    <div class="particles-layer"></div>

    <!-- Саундэффекты -->
    <audio id="click-sound" preload="auto">
        <source src="click.mp3" type="audio/mpeg">
    </audio>

    <!-- Музыкальное сопровождение -->
    <audio id="background-music" loop autoplay muted>
        <source src="background-music.mp3" type="audio/mpeg">
    </audio>

    <script>
        let language = 'ru'; // Russian by default
        let lastActivityTime = Date.now(); // Время последнего визита
        let cookies = parseInt(localStorage.getItem('cookies')) || 0; // Количество накопленных очков
        let baseIncrement = 1; // Базовый прирост очков
        let passiveIncome = 0; // Пассивный доход
        let upgradeLevels = JSON.parse(localStorage.getItem('upgradeLevels')) || [0, 0, 0, 0]; // Уровни улучшений

        const upgrades = [
            {nameRU: 'Производительность', nameEN: 'Productivity', initialCost: 10, perLevel: 1, passBoost: 0}, // Первая фабрика
            {nameRU: 'Маленькая фабрика', nameEN: 'Small Factory', initialCost: 100, perLevel: 0, passBoost: 1}, // Вторая фабрика
            {nameRU: 'Средняя фабрика', nameEN: 'Medium Factory', initialCost: 1000, perLevel: 10, passBoost: 10}, // Третья фабрика
            {nameRU: 'Большая фабрика', nameEN: 'Big Factory', initialCost: 10000000, perLevel: 10000, passBoost: 10000} // Суперфабрика
        ];

        // Список достижений
        const achievements = [
            {nameRU: 'Новичок', nameEN: 'Beginner', threshold: 10},
            {nameRU: 'Пекарь', nameEN: 'Baker', threshold: 100},
            {nameRU: 'Шеф-повар', nameEN: 'Chef', threshold: 1000},
            {nameRU: 'Богатый человек', nameEN: 'Rich Man', threshold: 10000},
            {nameRU: 'Миллионер', nameEN: 'Millionaire', threshold: 1000000},
            {nameRU: 'Бизнесмен', nameEN: 'Businessman', threshold: 10000000},
            {nameRU: 'Архимиллиардер', nameEN: 'Archmillionaire', threshold: 1000000000},
            {nameRU: 'Магнат', nameEN: 'Magnate', threshold: 1000000000000},
            {nameRU: 'Философ', nameEN: 'Philosopher', condition: hasMaxLevel()},
            {nameRU: 'Император', nameEN: 'Emperor', condition: areAllUpgradesMaxed()}
        ];

        // Проверка выполненных достижений
        function checkAchievements() {
            const achievementsList = document.getElementById('achievements');
            achievements.forEach((achievement, index) => {
                // Проверяем, выполнены ли условия достижения и не показано ли оно ранее
                if (
                    !isAchievementShown(index) &&
                    ((typeof achievement.threshold !== 'undefined' && cookies >= achievement.threshold) ||
                     typeof achievement.condition === 'boolean' && achievement.condition)
                ) {
                    markAchievementAsShown(index); // Помечаем достижение как просмотренное
                    const li = document.createElement('li');
                    li.textContent = language === 'ru' ? achievement.nameRU : achievement.nameEN;
                    achievementsList.append(li);

                    // Сообщение о достижении отображается 5 секунд
                    setTimeout(() => {
                        achievementsList.removeChild(li);
                    }, 5000);
                }
            });
        }

        // Расчёт стоимости и эффекта от улучшения
        function calculateUpgrade(upgradeIndex) {
            const level = upgradeLevels[upgradeIndex];
            return {
                currentEffect: upgrades[upgradeIndex].perLevel * level, // Активный эффект от уровня
                nextCost: upgrades[upgradeIndex].initialCost * Math.pow(2, level), // Стоимость следующего уровня
                passiveBoost: upgrades[upgradeIndex].passBoost * level // Пассивный прирост от уровня
            };
        }

        // Генерация магазина
        function generateStore() {
            const storeDiv = document.getElementById('store');
            storeDiv.innerHTML = '';

            upgrades.forEach((upgrade, i) => {
                const data = calculateUpgrade(i);
                let div = document.createElement('div');
                div.className = 'store-item';
                div.innerHTML = `
                    <b>${language === 'ru' ? upgrade.nameRU : upgrade.nameEN}</b><br/>
                    Уровень: ${upgradeLevels[i]}/100<br/>
                    Эффект: +${
                        upgrade.perLevel > 0 ?
                            data.currentEffect :
                            data.passiveBoost
                    }<br/>
                    Следующая покупка: ${data.nextCost}<br/>
                    ${upgradeLevels[i] >= 100 ? '<span style="color:#FF0000;">MAX LVL</span>' : ''}<br/>
                    <button onclick="buyUpgrade(${i}); flyingCookies(event.clientX, event.clientY)">Повысить (${data.nextCost})</button>
                `;
                storeDiv.appendChild(div);
            });
        }

        // Главная функция клика по печенью
        function clickCookie(e) {
            const bonuses = calculateBonuses();
            cookies += baseIncrement + bonuses.powerBoost;
            saveState(); // Сохраняем состояние при каждом клике
            document.getElementById('coins').innerText = `Cookies: ${cookies}`;
            checkAchievements(); // Проверяем достижения после каждого клика
            
            // Печенье летят при клике
            flyingCookies(e.clientX, e.clientY);
        }

        // Вылетающая куча печений
        function flyingCookies(x, y) {
            const particlesLayer = document.querySelector('.particles-layer');
            for (let i = 0; i < 20; i++) { // Чуть меньше печений
                const flyingCookie = document.createElement('img');
                flyingCookie.src = 'cookie.png';
                flyingCookie.alt = 'Cookie';
                flyingCookie.classList.add('flying-cookie');

                // Начальное положение у мыши
                flyingCookie.style.left = `${x}px`;
                flyingCookie.style.top = `${y}px`;
                
                // Различные направления полёта
                const angle = Math.random() * 360;
                flyingCookie.style.transformOrigin = 'center';
                flyingCookie.style.transform = `rotate(${angle}deg) translateX(-50%) translateY(-50%)`;

                particlesLayer.appendChild(flyingCookie);
                setTimeout(() => {
                    particlesLayer.removeChild(flyingCookie);
                }, 1000);
            }
        }

        // Покупка улучшения
        function buyUpgrade(index) {
            const data = calculateUpgrade(index);
            if (cookies >= data.nextCost && upgradeLevels[index] < 100) {
                cookies -= data.nextCost;
                upgradeLevels[index]++;
                saveState(); // Сохраняем состояние при покупке улучшения
                generateStore();
                document.getElementById('coins').innerText = `Cookies: ${cookies}`;
            } else {
                alert(language === 'ru' ? 'Недостаточно ресурсов или достигнуто MAX LVL!' : 'Not enough resources or reached MAX LVL!');
            }
        }

        // Подсчёт бонусов от улучшений
        function calculateBonuses() {
            let powerBoost = 0;
            let passiveBoost = 0;
            for (let i = 0; i < upgrades.length; i++) {
                const data = calculateUpgrade(i);
                powerBoost += data.currentEffect;
                passiveBoost += data.passiveBoost; // Учли пассивный прирост от каждого улучшения
            }
            return {powerBoost, passiveBoost};
        }

        // Автоматический пассивный доход
        setInterval(() => {
            const bonuses = calculateBonuses();
            cookies += bonuses.passiveBoost;
            saveState(); // Сохраняем состояние при автоматическом доходе
            document.getElementById('coins').innerText = `Cookies: ${cookies}`;
        }, 5000); // Каждые 5 секунд добавляем пассивный доход

        // Максимальное улучшение
        function hasMaxLevel() {
            return upgradeLevels.some(level => level === 100);
        }

        // Все улучшения завершены
        function areAllUpgradesMaxed() {
            return upgradeLevels.every(level => level === 100);
        }

        // Проверка наличия определённого достижения
        function isAchievementShown(index) {
            const shownAchievements = JSON.parse(localStorage.getItem('shownAchievements') || '{}');
            return shownAchievements.hasOwnProperty(index.toString());
        }

        // Помечаем достижение как просмотренное
        function markAchievementAsShown(index) {
            const shownAchievements = JSON.parse(localStorage.getItem('shownAchievements') || '{}');
            shownAchievements[index.toString()] = true;
            localStorage.setItem('shownAchievements', JSON.stringify(shownAchievements));
        }

        // Переключение языка
        function toggleLanguage() {
            language = language === 'ru' ? 'en' : 'ru';
            document.getElementById('gameTitle').textContent = language === 'ru' ? 'Cookie Clicker — CCCoin' : 'Cookie Clicker — CCCoin';
            document.getElementById('versionLabel').textContent = language === 'ru' ? '(ЭТО БЕТА-ВЕРСИЯ 1.1 НЕ СУДИТЕ СТРОГО)' : '(THIS IS BETA VERSION 1.1 DO NOT JUDGE)';
            document.getElementById('storeHeader').textContent = language === 'ru' ? 'Магазин улучшений:' : 'Improvement Store:';
            generateStore();
        }

        // Управление звуком
        function toggleSound() {
            const bgMusic = document.getElementById('background-music');
            if(bgMusic.muted) {
                bgMusic.muted = false;
            } else {
                bgMusic.muted = true;
            }
        }

        // Привязка кошелька временно недоступна
        function bindWallet() {
            alert(language === 'ru' ? "Скоро появится!" : "Coming soon!");
        }

        // Функция открытия/закрытия меню настроек
        function toggleSettings() {
            const settingsMenu = document.getElementById('settings-menu');
            settingsMenu.classList.toggle('visible'); // Меняем класс, который делает меню видимым
        }

        // Сохранение текущего состояния игры
        function saveState() {
            localStorage.setItem('cookies', cookies);
            localStorage.setItem('lastActivityTime', Date.now());
            localStorage.setItem('upgradeLevels', JSON.stringify(upgradeLevels));
        }

        // Загрузка предыдущего состояния игры
        function loadState() {
            const savedLastActivityTime = localStorage.getItem('lastActivityTime');
            if(savedLastActivityTime) {
                const timeDifference = Date.now() - Number(savedLastActivityTime);
                const bonuses = calculateBonuses();
                const offlineEarnings = Math.floor(timeDifference / 5000) * bonuses.passiveBoost; // Вычисляем пассивную прибыль за время отсутствия
                cookies += offlineEarnings;
                document.getElementById('coins').innerText = `Cookies: ${cookies}`;
            }
        }

        // Закрытие меню при клике вне области
        document.addEventListener('click', (event) => {
            const settingsButton = document.getElementById('settings-button');
            const settingsMenu = document.getElementById('settings-menu');
            if(settingsButton !== event.target && !settingsMenu.contains(event.target)) {
                settingsMenu.classList.remove('visible'); // Скрываем меню, если щелчок вне его
            }
        });

        // Обработка события закрытия страницы
        window.addEventListener('beforeunload', () => {
            saveState();
        });

        // Щелкаем по печенью
        document.querySelector('.cookie-container').addEventListener('click', () => {
            const audio = new Audio('click.mp3');
            audio.play();
        });

        // Генерируем магазин при загрузке страницы
        window.onload = function() {
            loadState(); // Загружаем предыдущее состояние
            generateStore();
        };
    </script>
</body>
</html>
